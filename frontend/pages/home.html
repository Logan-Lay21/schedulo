<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task Calendar with Google Calendar Integration</title>
    <!-- FullCalendar CSS -->
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.10.1/main.min.css" rel="stylesheet">
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google API Client Library -->
    <script src="https://apis.google.com/js/api.js"></script>
</head>
<body>
    <header class="fixed top-0 left-0 w-full bg-white bg-opacity-90 backdrop-blur-md shadow-lg z-50">
        <nav class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex items-center justify-between h-16">
          <a href="index.html" class="text-xl font-bold text-blue-500">Schedulo</a>
          <div class="hidden md:flex space-x-8">
            <a href="index.html" class="nav-link text-gray-800 hover:text-blue-500 transition-colors">Home</a>
            <a href="signin.html" class="nav-link text-gray-800 hover:text-blue-500 transition-colors">Login</a>
            <a href="signin.html" class="nav-link text-gray-800 hover:text-blue-500 transition-colors">Signin</a>
            <a href="chat.html" class="nav-link text-gray-800 hover:text-blue-500 transition-colors">Chat</a>
            <a href="home.html" class="nav-link text-gray-800 hover:text-blue-500 transition-colors">Calendar</a>
          </div>
          <button id="menu-toggle" class="md:hidden text-gray-800 focus:outline-none">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
            </svg>
          </button>
        </nav>
    </header>

    <div class="container mx-auto my-24 p-6">
        <div class="flex flex-col items-center space-y-4">
            <button onclick="window.location.href='mailto:gmail.com'" class="bg-blue-500 text-white px-6 py-2 rounded-lg shadow-md hover:bg-blue-600">
                Send to Gmail
            </button>
            <button onclick="connectToCanvas()" class="bg-green-500 text-white px-6 py-2 rounded-lg shadow-md hover:bg-green-600">
                Connect to Canvas
            </button>
        </div>
    
        <div class="mb-6">
            <h2 class="text-xl font-semibold">Enter Task</h2>
            <form id="task-form" class="space-y-4">
                <input id="task-title" type="text" placeholder="Task Title" class="w-full p-2 border border-gray-300 rounded">
                <textarea id="task-description" placeholder="Task Description" class="w-full p-2 border border-gray-300 rounded"></textarea>
                <input id="task-date" type="datetime-local" class="w-full p-2 border border-gray-300 rounded">
                <button type="submit" class="w-full p-2 bg-blue-500 text-white rounded">Add Task</button>
            </form>
        </div>
    
        <div id="calendar"></div>
    </div>
    <div class="container mx-auto my-8 p-6">
        <!-- Task Input Form -->
        <div class="mb-6">
            <h2 class="text-xl font-semibold">Enter Task</h2>
            <form id="task-form" class="space-y-4">
                <input id="task-title" type="text" placeholder="Task Title" class="w-full p-2 border border-gray-300 rounded">
                <textarea id="task-description" placeholder="Task Description" class="w-full p-2 border border-gray-300 rounded"></textarea>
                <input id="task-date" type="datetime-local" class="w-full p-2 border border-gray-300 rounded">
                <button type="submit" class="w-full p-2 bg-blue-500 text-white rounded">Add Task</button>
            </form>
        </div>

        <!-- Calendar Display -->
        <div id="calendar"></div>
    </div>
    <footer class="bg-gray-800 text-white py-6">
        <div class="max-w-7xl mx-auto text-center">
          <p>&copy; 2025 Schedulo. All rights reserved.</p>
        </div>
      </footer>

    <!-- FullCalendar JS -->
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.10.1/main.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@fullcalendar/interaction@5.10.1/main.global.min.js"></script>
    <script>
        function connectToCanvas() {
            // Get the current URL
            const currentUrl = window.location.href;
            
            // Extract the query string (if it exists)
            const urlParams = new URLSearchParams(window.location.search);
            const queryString = urlParams.toString();  // Get query string as 'key=value'
    
            // If there's a query string, append it to the video.html URL
            let videoUrl = "video.html";
            if (queryString) {
                videoUrl += "?" + queryString;
            }
    
            // Redirect to video.html with the query string (if exists)
            window.location.href = videoUrl;
        }
    </script>
    <script>
        // Google API client setup
                console.log("Google API Initialized");
        let CLIENT_ID = 'AIzaSyDns58J-FecXztxwv-J7GG0n8MeVQecZiY'; // Your client ID
        let API_KEY = 'AIzaSyDns58J-FecXztxwv-J7GG0n8MeVQecZiY'; // Your API key
        let SCOPES = "https://www.googleapis.com/auth/calendar";

        function initGoogleApi() {
            gapi.client.init({
                apiKey: API_KEY,
                clientId: CLIENT_ID,
                scope: SCOPES,
            }).then(function () {
                console.log("Google API Initialized");
            });
        }

        // Authenticate and load Google Calendar API
        function authenticate() {
            gapi.auth2.getAuthInstance().signIn().then(function () {
                loadCalendarApi();
            });
        }

        function loadCalendarApi() {
            gapi.client.load("calendar", "v3", function () {
                console.log("Google Calendar API Loaded");
            });
        }

        // Add Event to Google Calendar
        function addEventToGoogleCalendar(event) {
            var eventDetails = {
                "summary": event.title,
                "description": event.description,
                "start": {
                    "dateTime": event.start,
                    "timeZone": "America/Los_Angeles"
                },
                "end": {
                    "dateTime": event.end,
                    "timeZone": "America/Los_Angeles"
                }
            };

            var request = gapi.client.calendar.events.insert({
                "calendarId": "primary",
                "resource": eventDetails
            });

            request.execute(function (event) {
                console.log("Event created: ", event);
                alert("Event successfully added to Google Calendar!");
            });
        }

        document.addEventListener('DOMContentLoaded', function() {
            const calendarEl = document.getElementById('calendar');
            const taskForm = document.getElementById('task-form');
            const taskTitle = document.getElementById('task-title');
            const taskDescription = document.getElementById('task-description');
            const taskDate = document.getElementById('task-date');

            const calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                editable: true,
                droppable: true,
                headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'dayGridMonth,timeGridWeek,timeGridDay'
                },
                drop: function(info) {
                    const droppedEvent = {
                        title: 'New Task',
                        start: info.dateStr,
                        color: '#3498db'
                    };
                    calendar.addEvent(droppedEvent);
                    addEventToGoogleCalendar(droppedEvent);
                    alert('New task added!');
                },
                eventClick: function(info) {
                    const event = info.event;
                    const deleteEvent = confirm(`Do you want to delete the event: ${event.title}?`);
                    if (deleteEvent) {
                        event.remove();
                        alert('Event deleted!');
                    }
                }
            });

            calendar.render();

            // Task form submission
            taskForm.addEventListener('submit', function(event) {
                event.preventDefault();

                const title = taskTitle.value;
                const description = taskDescription.value;
                const date = taskDate.value;

                if (title && date) {
                    const newEvent = {
                        title: title,
                        start: date,
                        description: description || '',
                        color: '#FF5733',
                    };

                    calendar.addEvent(newEvent);
                    addEventToGoogleCalendar(newEvent);

                    taskTitle.value = '';
                    taskDescription.value = '';
                    taskDate.value = '';
                    alert('Task added to calendar!');
                } else {
                    alert('Please fill in all the fields.');
                }
            });

            // Load the Google API client library
            gapi.load("client:auth2", initGoogleApi);
        });
    </script>
</body>
</html>